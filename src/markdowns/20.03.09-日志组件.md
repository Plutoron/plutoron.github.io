#### 一个日志组件

```
import { Component } from 'react'
import { Modal, Button, Icon } from 'antd'
import ErrorEater from '@dtwave/error-eater'

export default class Log extends Component {
    timer = undefined
    logView = undefined

    defaultParam = {}
    getData = undefined

    state = {
        visible: false,
        finished: false,

        startLine: 1,
        limitSize: 10240,

        logs: [],
    }

    componentDidMount() {
        emitter.addListener('log_show', (getData, defaultParam) => {
            console.log(getData, defaultParam)
            this.setState({
                visible: true,
            })
            this.defaultParam = defaultParam
            this.getData = getData

            this.getLog(defaultParam)
        })
    }

    componentWillUnmount() {
        // 组件销毁之前，把监听事件销毁
        // 这是为了避免过度使用emitter，造成资源浪费，也容易造成重复触发
        emitter.removeAllListeners()
    }

    onClose = () => {
        this.setState({
            visible: false,
            logs: [],
            startLine: 1,
            finished: false
        })

        clearTimeout(this.timer)
    }

    getLog = async () => {
        const {
            state: { startLine, limitSize, logs }
        } = this

        try {
            const res = await this.getData({
                ...this.defaultParam,
                startLine,
                limitSize,
            })

            let _startLine = startLine + limitSize

            const endFlag = 'END-EOF-END-EOF'

            const finished = res.data.endsWith(endFlag)

            if (finished) res.data = res.data.slice(0, - endFlag.length)

            // 判断 如果 获取到的日志 长度 不为 10240 并且 不 finished

            if (!finished && res.data.length <= limitSize) {
                _startLine = res.startLine + res.data.length
            }

            console.log(_startLine)

            this.setState({
                finished,
                startLine: _startLine,
                logs: logs.concat((res.data || '').split('\n'))
            })

            if (!finished) {
                this.timer = setTimeout(() => {
                    this.getLog()
                }, 1000)
            } else {
                clearTimeout(this.timer)
            }
        } catch (e) {
            ErrorEater(e)
        }
    }

    render() {
        const t = this
        const { visible, finished, logs} = t.state

        return (
            <Modal
                visible={visible}
                title="查看日志"
                onCancel={this.onClose}
                width={840}
                footer={[
                    <Button
                        key="back"
                        onClick={this.onClose}
                        type="primary"
                    >
                        关闭
                    </Button>
                ]}
                destroyOnClose
            >
                <div
                    style={{ height: 400, overflow: 'auto', margin: 0 }}
                    ref={e => (this.logView = e)}
                >
                    {
                        logs.map(v => (
                            <div>
                                {v}
                            </div>
                        ))
                    }

                    <div className="mt30 mb30" style={{textAlign: "center"}}>
                        {finished ? (
                            '暂无更多日志'
                        ) : (
                            <Icon type="loading" />
                        )}
                    </div>
                </div>
            </Modal>
        )
    }
}

```