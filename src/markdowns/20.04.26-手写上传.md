### 手写上传

```
const formData = new FormData() // 新建formData对象

formData.append('file', originFileObj) // 将file添加到formData传到后端
formData.append('uploadId', uploadId) // 将 viewPath 添加到formData传到后端

const xhr = new XMLHttpRequest() // 新建ajax异步对象,将当前xhr 写入 process, 保存当前进程

xhr.open('post', `${urlPrefix}file_upload/file?uploadId=${uploadId}`) // 打开ajax
// 监听ajax对象事件状态
// readyState
// 0: 请求未初始化
// 1: 服务器连接已建立
// 2: 请求已接收
// 3: 请求处理中
// 4: 请求已完成，且响应已就绪
xhr.onreadystatechange = function() {
    console.log('onreadystatechange ------------', xhr)

    if (xhr.readyState == 4) {
        if (xhr.status == 200) {
            const response = JSON.parse(xhr.response)

            if (response.success) {
                setStatus('DONE')
                setProgress(100)
            } else {
                ErrorEater(response)
                setStatus('ERROR')
            }
        }
        else {
            setStatus('ERROR')
        }

        emitter.emit(`file_upload_done_${uid}`)
        emitter.emit('file_upload_task_done')
        emitter.emit(`file_upload_process_delete`, uid)
    }
}

// 监听文件上传进度
xhr.upload.onprogress = function(ev) {
    if (ev.lengthComputable) {
        const progress = Math.floor((ev.loaded / ev.total) * 100)

        if (_status === 'CANCEL' || _status === 'ERROR') return

        if (_status === 'WAITING') setStatus('UPLOADING')

        if (progress === 100) return

        setProgress(progress)
    }
}

xhr.send(formData) // 发送ajax请求将formData对象发送过去
```