### webpack 打包原理
1. 读取文件分析模块依赖
2. 对模块进行解析执行（深度遍历）
3. 针对不同的模块使用相应的loader
4. 编译模块，生成抽象语法树（AST）
5. 循环遍历AST树，拼接js

### loader 原理
> loader 本质是一个函数，输入参数是一个字符串，输出参数也是一个字符串。当然，输出的参数会被当成js代码，从而被 esprima 解析成 AST，触发进一步的依赖解析。

> webpack 会从右到左的顺序执行loader 

### webpack 热更新原理

![alt webpack热更新](../markdown-images/webpack-hot-update.jpeg)

Server端使用webpack-dev-server去启动本地服务，内部实现主要使用了webpack、express、websocket。

* 使用express启动本地服务，当浏览器访问资源时对此做响应。
* 服务端和客户端使用websocket实现长连接
* webpack监听源文件的变化，即当开发者保存文件时触发webpack的重新编译。

  * 每次编译都会生成hash值、已改动模块的json文件、已改动模块代码的js文件
  * 编译完成后通过socket向客户端推送当前编译的hash戳

* 客户端的websocket监听到有文件改动推送过来的hash戳，会和上一次对比

  * 一致则走缓存
  * 不一致则通过ajax和jsonp向服务端获取最新资源
  
* 使用内存文件系统去替换有修改的内容实现局部刷新
